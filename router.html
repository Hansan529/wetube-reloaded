<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ROUTER</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <h1>#4.0 What are Routers?</h1>
    <p>기본적인 URL 경로이다.</p>
    <pre class="codeBlock">
      / → home
      /join → Join
      /login → Login
      /search → Search

      /edit-user → Edit User
      /delete-user → Delete User
      /watch-video → What Video
      /edit-video → Edit Video
      /delete-video → Delete Video
    </pre>
    <p>해당 주제에 대해 라우터를 통해 정리해겠다.</p>

    <p>라우터는 작업중인 주제를 기반으로 URL을 그룹화한다.</p>

    <pre class="codeBlock">
      <span class="comment">// /edit-user → Edit User</span>
      /users/edit → Edit <meta name="uservoice" content="#" />

      <span class="comment">// /delete-user → Delete User</span>
      /users/delete

      <span class="comment">// /watch-video → What Video</span>
      /videos/watch

      <span class="comment">// /edit-video → Edit Video</span>
      /videos/edit

      <span class="comment">// /delete-video → Delete Video</span>
      /videos/delete
    </pre>
    <pre class="codeBlock">
      <span class="comment">/* 글로벌 라우터(global router)</span>
      <span class="comment">홈에서 바로 갈 수 있는 페이지들을 담고 있다. */</span>
      / → Home
      /join → Join
      /login → Login
      /search → Search

      <span class="comment">/* 기존 규칙대로 Router를 작성해본다면 아래와 같을 거다.</span>
      <span class="comment">user가 join, login을 하는 것이 명확하고, video를 search하는 것으로 명확히 구분 되어 있기 때문이다. */</span>
      /users/join
      /users/login
      /videos/search

      <span class="comment">/* 하지만 간략하게 하여 접근이 쉽도록 할 때 예외로 router를 만들기도 한다.</span>
      <span class="comment">두 차이를 보면 이해하기 쉽다. */</span>
      http://hansan529.github.io/wetube-reloaded/join
      http://hansan529.github.io/wetube-reloaded/users/join 
    </pre>
    <p>라우터에 대해 알았으니, 생성하는 방법에 대해 알아보자</p>
    <br />
    <pre class="codeBlock">
      <span class="comment">// 생성</span>
      <span class="const">const</span> <span class="tag">globalRouter</span> = express.<span class="attribute">Router</span>();
      <span class="const">const</span> <span class="tag">userRouter</span> = express.<span class="attribute">Router</span>();
      <span class="const">const</span> <span class="tag">videoRouter</span> = express.<span class="attribute">Router</span>();
      
      <span class="comment">// 사용</span>
      app.<span class="attribute">use</span>(<span class="text">"/"</span>, globalRouter);
      app.<span class="attribute">use</span>(<span class="text">"/users"</span>, userRouter);
      app.<span class="attribute">use</span>(<span class="text">"/videos"</span>, videoRouter);
    </pre>
    <p>Router들의 첫 페이지를 생성한다.</p>
    <pre class="codeBlock">
      <span class="const">const</span> <span class="tag">globalRouter</span> = express.<span class="console">Router</span>();
      <span class="const">const</span> <span class="attribute">handleHome</span> = (req, res) =&gt; res.<span class="attribute">send</span>(<span class="text">"home"</span>);
      globalRouter.<span class="attribute">get</span>(<span class="text">"/"</span>, handleHome)

      <span class="const">const</span> <span class="tag">userRouter</span> = express.<span class="console">Router</span>();
      <span class="const">const</span> <span class="attribute">handleEditUser</span> = (req, res) =&gt; res.<span class="attribute">send</span>(<span class="text">"Edit User"</span>);
      userRouter.<span class="attribute">get</span>(<span class="text">"/edit"</span>, handleEditUser)

      <span class="const">const</span> <span class="tag">videoRouter</span> = express.<span class="console">Router</span>();
      <span class="const">const</span> <span class="attribute">handleWatchVideo</span> = (req, res) =&gt; res.<span class="attribute">send</span>(<span class="text">"home"</span>);
      videoRouter.<span class="attribute">get</span>(<span class="text">"/watch"</span>, handleWatchVideo)
    </pre>
    <p>
      request에서 "/videos"로 시작하는 url을 찾는다면, Express는 videoRouter를
      실행하여, /watch 루트를 이용하게 된다. <br />
      그 덕분에 <span class="codeline">/videos/watch</span> 라고 지정을 하지
      않아도 이동이 된다.
    </p>
    <h1>#4.2 Cleaning the Code</h1>
    <p>작동하는 코드를 완성했을 때, 너저분한 코드를 정리해주어야 한다.</p>
    <p>
      우선 컨트롤러와 라우터를 분리해준다. 모듈과 같이 별도의 파일에서도
      독립적으로 작동해야하기에, 분리한 파일에서도 express를 import 해야 한다.
    </p>
    <pre class="codeBlock">
      <span class="comment">// 기존 파일 구성 (통합)</span>
      <span class="const">src</span>/server.js

      <span class="comment">// 이후의 파일 구성 (분리)</span>
      <span class="const">src</span>/<span class="attribute">routers</span>/globalRouter.js
      <span class="const">src</span>/<span class="attribute">routers</span>/userRouter.js
      <span class="const">src</span>/<span class="attribute">routers</span>/videoRouter.js
    </pre>
    <p>
      server.js 에서 router들을 불러오기 위해서는 router에서 export를 진행해야
      한다. 개개인의 독립적인 파일이기에 공개되어있지 않아서, 같은 이름을
      지정하더라도 아무런 문제가 없다.
    </p>
    <p>
      우리는 파일 자체를 import 할 것이 아닌, 변수만 import 하고자 하는 것이기에
      코드를 작성해준다.
    </p>
    <pre class="codeBlock">
      <span class="comment">// server.js</span>
      <span class="json">import</span> globalRouter <span class="json">from</span> ".<span class="text">/routers/globalRouter</span>";
      <span class="json">import</span> userRouter <span class="json">from</span> ".<span class="text">/routers/userRouter</span>";
      <span class="json">import</span> videoRouter <span class="json">from</span> ".<span class="text">/routers/videoRouter</span>";

      <span class="comment">// globalRouter.js</span>
      <span class="json">import</span> express <span class="json">from</span> "<span class="text">express</span>";
      
      <span class="const">const</span> <span class="tag">globalRouter</span> = express.<span class="console">Router</span>();
      
      <span class="const">const</span> <span class="attribute">handleHome</span> = (req, res) =&gt; res.send("home");
      
      globalRouter.<span class="attribute">get</span>("<span class="text">/</span>", handleHome);
      
      <span class="json">export</span> <span class="json">default</span> globalRouter;span
      
      <span class="comment">// userRouter.js</span>
      <span class="comment">// videoRouter.js</span>
    </pre>
    <p>
      server 파일에 있던 코드를 모두 옮기고 Router에서는 Export를 하며
      server.js에서는 이를 import 하여 이용한다. 여러개의 Router를 추가해도
      동일하다.
    </p>
    <p>
      허나, 하나 두개의 적은 개수라면 괜찮겠지만, 많아지면 Router.js 안에
      Controller와 Router 두 가지가 모두 들어있기에 이를 또 분리해준다.
    </p>
    <pre class="codeBlock">
      <span class="comment">// src</span>
      <span class="attribute">controllers</span>/userController.js
      <span class="attribute">controllers</span>/videoController.js
    </pre>
    <p>
      globalController가 없는 이유는 url을 간단하게 사용하려고 만든 것이기에,
      실제로 이용하는 것은 user와 videoController 범위에 들어간다.
    </p>
    <pre class="codeBlock">
      <span class="comment">// userController</span>
      <span class="const">const</span> join = (req, res) =&gt; res.<span class="attribute">send</span>("<span class="text">Join</span>");
      <span class="json">export default</span> join;

      <span class="comment">// videoController</span>
      <span class="const">const</span> trending = (req, res) =&gt; res.<span class="attribute">send</span>("<span class="text">Home Page Videos</span>");
      <span class="json">export default</span> trending;

      <span class="comment">// globalRouter</span>
      <span class="json">import</span> express <span class="json">from</span> "<span class="text">express</span>";
      <span class="json">import</span> join <span class="json">from</span> "<span class="text">../controllers/userController</span>";
      <span class="json">import</span> trending <span class="json">from</span> "<span class="text">../controllers/videoController</span>";

      <span class="const">const</span> <span class="tag">globalRouter</span> = express.<span class="attribute">Router</span>();

      globalRouter.<span class="attribute">get</span>("/", trending);
      globalRouter.<span class="attribute">get</span>("/join", join);

      <span class="json">export default</span> globalRouter;
    </pre>
    <p>
      Router를 server에서 독립시킬 때와 마찬가지로 별도의 js에서 controller
      변수를 지정하고, export한 다음 router에서 import하는 것이다.
    </p>
    <p>
      다만 문제점은 export default는 하나밖에 export하지 못한다. 그래서 이름은
      상관 없이 지정할 수 있는 것이다.
    </p>
    <pre class="codeBlock">
      <span class="comment">// globalRouter</span>
      import express from "express";
      import { join } from "../controllers/userController";
      import { trending } from "../controllers/videoController";
      
      const globalRouter = express.Router();
      
      globalRouter.get("/", trending);
      globalRouter.get("/join", join);
      
      export default globalRouter;
      
      
      <span class="comment">// videoController</span>
      export const trending = (req, res) =&gt; res.send("Home Page Videos");
      export const watch = (req, res) =&gt; res.send("Watch");
      export const edit = (req, res) =&gt; res.send("Eidt");
    </pre>
    <p>
      하지만 export를 변수 앞에 지정해줄 경우, 여러개를 export 할 수 있다.
      하지만 정확한 이름을 작성해주어야 정상적으로 값을 불러온다.
    </p>
    <p>
      만약에 없는 router를 불러올 경우 이와 같은 에러가 발생한다.
      <br />
      <span class="codeline"
        >Route.get() requires a callback function but got a [object
        Undefined]</span
      >
      라우터에게 존재하지 않은 함수를 지정했다는 말이다.
    </p>
    <br />
    <h2>복습</h2>
    <pre class="codeBlock">
      <span class="comment">// 현재까지의 코드</span>

      <span class="comment">// server.js</span>
      import express from "express";
      import morgan from "morgan";
      import globalRouter from "./routers/globalRouter";
      import videoRouter from "./routers/videoRouter";
      import userRouter from "./routers/userRouter";
      const PORT = 4000;
      const app = express();
      const logger = morgan("dev");
      app.use(logger);
      app.use("/", globalRouter);
      app.use("/users", userRouter);
      app.use("/videos", videoRouter);
      const handleListening = () =&gt; console.log(`Server listening on port http://localhost:${PORT} 🚀`);
      app.listen(PORT, handleListening);

      <span class="comment">// globalRouter.js</span>
      import express from "express";
      import { join } from "../controllers/userController";
      import { trending } from "../controllers/videoController";
      const globalRouter = express.Router();
      globalRouter.get("/", trending);
      globalRouter.get("/join", join);
      export default globalRouter;

      <span class="comment">// videoRouter.js</span>
      import express from "express";
      import { watch } from "../controllers/videoController";
      import { edit } from "../controllers/videoController";
      const videoRouter = express.Router();
      videoRouter.get("/watch", watch);
      videoRouter.get("/edit", edit);
      export default videoRouter;

      <span class="comment">// userRouter.js</span>
      import express from "express";
      import { edit, remove } from "../controllers/userController";
      const userRouter = express.Router();
      userRouter.get("/edit", edit);
      userRouter.get("/delete", remove);
      export default userRouter;

      <span class="comment">// userController.js</span>
      export const join = (req, res) =&gt; res.send("Join");
      export const edit = (req, res) =&gt; res.send("Edit User");
      export const removed = (req, res) =&gt; res.send("Remove User");


      <span class="comment">// videoController.js</span>
      export const trending = (req, res) =&gt; res.send("Home Page Videos");
      export const watch = (req, res) =&gt; res.send("Watch");
      export const edit = (req, res) =&gt; res.send("Eidt");
    </pre>
    <p>라우터는 url이 어떻게 시작하는지에 따라 나누는 방법이다.</p>
  </body>
</html>
